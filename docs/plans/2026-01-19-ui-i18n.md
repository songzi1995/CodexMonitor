# UI I18n Implementation Plan

> **REQUIRED SUB-SKILL:** Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Introduce a lightweight i18n system and translate the UI to Chinese with stable keys so upstream updates only require adding new keys.

**Architecture:** Add a small i18n module under `src/i18n/` with JSON translations, a React context provider, and a `t()` helper. Persist locale in `localStorage`, defaulting to `zh-CN` for Chinese browsers, otherwise `en`. Add a parity check script to keep `zh-CN` keys in sync with `en`.

**Tech Stack:** React, Vite, TypeScript, Node.js (scripts).

---

### Task 1: Add i18n key parity test + base translation files

**Files:**
- Create: `scripts/check-i18n-keys.mjs`
- Create: `src/i18n/translations/en.json`
- Create: `src/i18n/translations/zh-CN.json`
- Modify: `package.json`

**Step 1: Write the failing test (key parity script + npm script)**

Add to `package.json`:

```json
{
  "scripts": {
    "test:i18n": "node scripts/check-i18n-keys.mjs"
  }
}
```

Create `scripts/check-i18n-keys.mjs`:

```js
import { readFile } from "node:fs/promises";
import path from "node:path";
import { fileURLToPath } from "node:url";

const root = path.resolve(path.dirname(fileURLToPath(import.meta.url)), "..");
const enPath = path.join(root, "src/i18n/translations/en.json");
const zhPath = path.join(root, "src/i18n/translations/zh-CN.json");

function flattenKeys(node, prefix = "") {
  if (typeof node !== "object" || node === null) {
    return [];
  }
  return Object.entries(node).flatMap(([key, value]) => {
    const next = prefix ? `${prefix}.${key}` : key;
    if (typeof value === "string") {
      return [next];
    }
    return flattenKeys(value, next);
  });
}

const [enRaw, zhRaw] = await Promise.all([
  readFile(enPath, "utf8"),
  readFile(zhPath, "utf8"),
]);
const en = JSON.parse(enRaw);
const zh = JSON.parse(zhRaw);

const enKeys = new Set(flattenKeys(en));
const zhKeys = new Set(flattenKeys(zh));

const missing = [...enKeys].filter((key) => !zhKeys.has(key));
const extra = [...zhKeys].filter((key) => !enKeys.has(key));

if (missing.length || extra.length) {
  if (missing.length) {
    console.error(`Missing zh-CN keys (${missing.length}):`);
    missing.forEach((key) => console.error(`  - ${key}`));
  }
  if (extra.length) {
    console.error(`Extra zh-CN keys (${extra.length}):`);
    extra.forEach((key) => console.error(`  - ${key}`));
  }
  process.exit(1);
}

console.log(`i18n OK: ${enKeys.size} keys`);
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with ENOENT because translation files do not exist yet.

**Step 3: Create base translation files (English only)**

Create `src/i18n/translations/en.json` with minimal shared keys:

```json
{
  "common": {
    "close": "Close",
    "save": "Save",
    "cancel": "Cancel",
    "reset": "Reset",
    "loading": "Loading..."
  }
}
```

Do NOT create the Chinese file yet.

**Step 4: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with ENOENT for `zh-CN.json`.

**Step 5: Create Chinese translation file**

Create `src/i18n/translations/zh-CN.json`:

```json
{
  "common": {
    "close": "关闭",
    "save": "保存",
    "cancel": "取消",
    "reset": "重置",
    "loading": "加载中..."
  }
}
```

**Step 6: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS with `i18n OK: 5 keys`.

**Step 7: Commit**

```bash
git add package.json scripts/check-i18n-keys.mjs src/i18n/translations/en.json src/i18n/translations/zh-CN.json
git commit -m "chore: add i18n key parity check"
```

---

### Task 2: Add i18n provider + hook, wrap App, add language selector

**Files:**
- Create: `src/i18n/I18nProvider.tsx`
- Create: `src/i18n/useI18n.ts`
- Create: `src/i18n/index.ts`
- Modify: `src/main.tsx`
- Modify: `src/features/settings/components/SettingsView.tsx`
- Modify: `src/i18n/translations/en.json`
- Modify: `src/i18n/translations/zh-CN.json`

**Step 1: Add new English keys only (to make test fail)**

Append to `src/i18n/translations/en.json`:

```json
{
  "settings": {
    "language": {
      "label": "Language",
      "option": {
        "en": "English",
        "zh": "Chinese (Simplified)"
      }
    }
  }
}
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with missing `settings.language.*` keys in zh-CN.

**Step 3: Implement i18n core**

Create `src/i18n/I18nProvider.tsx`:

```tsx
import { createContext, useCallback, useMemo, useState } from "react";
import en from "./translations/en.json";
import zhCN from "./translations/zh-CN.json";

export type Locale = "en" | "zh-CN";
type MessageValue = string | Record<string, MessageValue>;
type Messages = Record<string, MessageValue>;
type MessageParams = Record<string, string | number>;

type I18nContextValue = {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string, vars?: MessageParams) => string;
};

const STORAGE_KEY = "codexmonitor.locale";
const FALLBACK_LOCALE: Locale = "en";
const MESSAGES: Record<Locale, Messages> = {
  en: en as Messages,
  "zh-CN": zhCN as Messages,
};
const missingKeys = new Set<string>();

function resolveMessage(messages: Messages, key: string): string | undefined {
  const parts = key.split(".");
  let cursor: MessageValue | undefined = messages;
  for (const part of parts) {
    if (!cursor || typeof cursor !== "object") {
      return undefined;
    }
    cursor = (cursor as Messages)[part];
  }
  return typeof cursor === "string" ? cursor : undefined;
}

function formatMessage(template: string, vars?: MessageParams): string {
  if (!vars) {
    return template;
  }
  return template.replace(/{{\\s*(\\w+)\\s*}}/g, (_, name) => {
    const value = vars[name];
    return value === undefined || value === null ? `{{${name}}}` : String(value);
  });
}

function getInitialLocale(): Locale {
  if (typeof window === "undefined") {
    return "en";
  }
  const stored = window.localStorage.getItem(STORAGE_KEY);
  if (stored === "en" || stored === "zh-CN") {
    return stored;
  }
  const browser = window.navigator.language.toLowerCase();
  return browser.startsWith("zh") ? "zh-CN" : "en";
}

function translate(locale: Locale, key: string, vars?: MessageParams): string {
  const message = resolveMessage(MESSAGES[locale], key);
  if (message) {
    return formatMessage(message, vars);
  }
  const fallback = resolveMessage(MESSAGES[FALLBACK_LOCALE], key);
  if (fallback) {
    if (import.meta.env.DEV && !missingKeys.has(key)) {
      missingKeys.add(key);
      console.warn(`[i18n] missing ${locale} key: ${key}`);
    }
    return formatMessage(fallback, vars);
  }
  if (import.meta.env.DEV && !missingKeys.has(key)) {
    missingKeys.add(key);
    console.warn(`[i18n] missing key: ${key}`);
  }
  return key;
}

const I18nContext = createContext<I18nContextValue | null>(null);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>(() => getInitialLocale());

  const setLocale = useCallback((next: Locale) => {
    setLocaleState(next);
    window.localStorage.setItem(STORAGE_KEY, next);
  }, []);

  const value = useMemo<I18nContextValue>(() => {
    return {
      locale,
      setLocale,
      t: (key, vars) => translate(locale, key, vars),
    };
  }, [locale, setLocale]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18nContext() {
  return I18nContext;
}
```

Create `src/i18n/useI18n.ts`:

```tsx
import { useContext } from "react";
import { useI18nContext } from "./I18nProvider";

export function useI18n() {
  const ctx = useContext(useI18nContext());
  if (!ctx) {
    throw new Error("useI18n must be used within I18nProvider");
  }
  return ctx;
}
```

Create `src/i18n/index.ts`:

```ts
export { I18nProvider } from "./I18nProvider";
export { useI18n } from "./useI18n";
export type { Locale } from "./I18nProvider";
```

Wrap `App` in `src/main.tsx`:

```tsx
import { I18nProvider } from "./i18n";

ReactDOM.createRoot(document.getElementById("root") as HTMLElement).render(
  <React.StrictMode>
    <I18nProvider>
      <App />
    </I18nProvider>
  </React.StrictMode>,
);
```

Add language selector to `src/features/settings/components/SettingsView.tsx`:

```tsx
import { useI18n } from "../../../i18n";

// inside SettingsView
const { t, locale, setLocale } = useI18n();

// in display section
<div className="settings-field">
  <label className="settings-field-label" htmlFor="ui-language">
    {t("settings.language.label")}
  </label>
  <select
    id="ui-language"
    className="settings-select"
    value={locale}
    onChange={(event) => setLocale(event.target.value as Locale)}
  >
    <option value="en">{t("settings.language.option.en")}</option>
    <option value="zh-CN">{t("settings.language.option.zh")}</option>
  </select>
</div>
```

**Step 4: Add Chinese translations**

Append to `src/i18n/translations/zh-CN.json`:

```json
{
  "settings": {
    "language": {
      "label": "语言",
      "option": {
        "en": "English",
        "zh": "简体中文"
      }
    }
  }
}
```

**Step 5: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS with updated key count.

**Step 6: Commit**

```bash
git add src/i18n src/main.tsx src/features/settings/components/SettingsView.tsx
git commit -m "feat: add i18n provider and language selector"
```

---

### Task 3: Translate Settings - Projects + Display + Sound

**Files:**
- Modify: `src/features/settings/components/SettingsView.tsx`
- Modify: `src/i18n/translations/en.json`
- Modify: `src/i18n/translations/zh-CN.json`

**Step 1: Add English keys only (make test fail)**

Add to `en.json`:

```json
{
  "settings": {
    "nav": {
      "projects": "Projects",
      "display": "Display",
      "dictation": "Dictation",
      "shortcuts": "Shortcuts",
      "codex": "Codex",
      "experimental": "Experimental"
    },
    "projects": {
      "title": "Projects",
      "subtitle": "Organize your workspaces into groups and set per-project defaults.",
      "empty": "No projects yet.",
      "delete": "Delete project"
    },
    "display": {
      "title": "Display & Sound",
      "subtitle": "Tune visuals and audio alerts to your preferences.",
      "section": {
        "display": "Display",
        "display_subtitle": "Adjust how the window renders backgrounds and effects.",
        "sounds": "Sounds",
        "sounds_subtitle": "Control notification audio alerts."
      },
      "reduce_transparency": {
        "title": "Reduce transparency",
        "subtitle": "Use solid surfaces instead of glass."
      },
      "interface_scale": {
        "title": "Interface scale",
        "aria": "Interface scale",
        "reset": "Reset"
      },
      "notification_sounds": {
        "title": "Notification sounds",
        "subtitle": "Play a sound when a long-running agent finishes while the window is unfocused.",
        "test": "Test sound"
      }
    }
  }
}
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with missing `settings.nav.*` / `settings.projects.*` / `settings.display.*` keys in zh-CN.

**Step 3: Replace strings in SettingsView**

Replace literals in the Projects + Display sections with `t(...)`:

```tsx
const { t } = useI18n();

<div className="settings-section-title">{t("settings.projects.title")}</div>
<div className="settings-section-subtitle">{t("settings.projects.subtitle")}</div>
{projects.length === 0 && (
  <div className="settings-empty">{t("settings.projects.empty")}</div>
)}
...
<div className="settings-section-title">{t("settings.display.title")}</div>
<div className="settings-section-subtitle">{t("settings.display.subtitle")}</div>
<div className="settings-subsection-title">{t("settings.display.section.display")}</div>
<div className="settings-subsection-subtitle">
  {t("settings.display.section.display_subtitle")}
</div>
...
<div className="settings-toggle-title">{t("settings.display.reduce_transparency.title")}</div>
<div className="settings-toggle-subtitle">
  {t("settings.display.reduce_transparency.subtitle")}
</div>
...
<input aria-label={t("settings.display.interface_scale.aria")} ... />
<button ...>{t("settings.display.interface_scale.reset")}</button>
...
<div className="settings-subsection-title">{t("settings.display.section.sounds")}</div>
<div className="settings-subsection-subtitle">
  {t("settings.display.section.sounds_subtitle")}
</div>
...
<div className="settings-toggle-title">{t("settings.display.notification_sounds.title")}</div>
<div className="settings-toggle-subtitle">
  {t("settings.display.notification_sounds.subtitle")}
</div>
<button ...>{t("settings.display.notification_sounds.test")}</button>
```

**Step 4: Add Chinese translations**

Add to `zh-CN.json`:

```json
{
  "settings": {
    "nav": {
      "projects": "项目",
      "display": "显示",
      "dictation": "语音输入",
      "shortcuts": "快捷键",
      "codex": "Codex",
      "experimental": "实验性"
    },
    "projects": {
      "title": "项目",
      "subtitle": "将工作区分组并设置每个项目的默认选项。",
      "empty": "暂无项目。",
      "delete": "删除项目"
    },
    "display": {
      "title": "显示与声音",
      "subtitle": "调整视觉效果和音频提醒。",
      "section": {
        "display": "显示",
        "display_subtitle": "调整窗口背景与效果的渲染方式。",
        "sounds": "声音",
        "sounds_subtitle": "控制通知音效。"
      },
      "reduce_transparency": {
        "title": "降低透明度",
        "subtitle": "使用不透明界面替代玻璃效果。"
      },
      "interface_scale": {
        "title": "界面缩放",
        "aria": "界面缩放",
        "reset": "重置"
      },
      "notification_sounds": {
        "title": "通知音效",
        "subtitle": "当窗口失焦且长任务完成时播放提示音。",
        "test": "测试声音"
      }
    }
  }
}
```

**Step 5: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS.

**Step 6: Commit**

```bash
git add src/features/settings/components/SettingsView.tsx src/i18n/translations/en.json src/i18n/translations/zh-CN.json
git commit -m "feat: translate settings projects/display"
```

---

### Task 4: Translate Settings - Dictation + Shortcuts

**Files:**
- Modify: `src/features/settings/components/SettingsView.tsx`
- Modify: `src/i18n/translations/en.json`
- Modify: `src/i18n/translations/zh-CN.json`

**Step 1: Add English keys only (make test fail)**

Add to `en.json`:

```json
{
  "settings": {
    "dictation": {
      "title": "Dictation",
      "subtitle": "Enable microphone dictation with on-device transcription.",
      "enable": {
        "title": "Enable dictation",
        "subtitle": "Downloads the selected Whisper model on first use."
      },
      "model": "Dictation model",
      "model_help": "{{note}} Download size: {{size}}.",
      "preferred_language": "Preferred dictation language",
      "preferred_language_help": "Auto-detect stays on; this nudges the decoder toward your preference.",
      "hold_key": "Hold-to-dictate key",
      "hold_key_help": "Hold the key to start dictation, release to stop and process.",
      "model_status": "Model status ({{model}})",
      "status": {
        "ready": "Ready for dictation.",
        "missing": "Model not downloaded yet.",
        "downloading": "Downloading model...",
        "error": "Download error."
      },
      "actions": {
        "download": "Download model",
        "cancel": "Cancel download",
        "remove": "Remove model"
      },
      "language_options": {
        "auto": "Auto-detect only",
        "en": "English",
        "es": "Spanish",
        "fr": "French",
        "de": "German",
        "it": "Italian",
        "pt": "Portuguese",
        "nl": "Dutch",
        "sv": "Swedish",
        "no": "Norwegian",
        "da": "Danish",
        "fi": "Finnish",
        "pl": "Polish",
        "tr": "Turkish",
        "ru": "Russian",
        "uk": "Ukrainian",
        "ja": "Japanese",
        "ko": "Korean",
        "zh": "Chinese"
      },
      "hold_key_options": {
        "off": "Off",
        "alt": "Option / Alt",
        "shift": "Shift",
        "control": "Control",
        "meta": "Command / Meta"
      }
    },
    "shortcuts": {
      "title": "Shortcuts",
      "subtitle": "Customize keyboard shortcuts for common actions.",
      "cycle_model": "Cycle model",
      "cycle_access": "Cycle access mode",
      "cycle_reasoning": "Cycle reasoning mode",
      "shortcut_help": "Press a new shortcut while focused. Default: {{shortcut}}",
      "shortcut_help_simple": "Default: {{shortcut}}",
      "input_placeholder": "Type shortcut",
      "clear": "Clear"
    }
  }
}
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with missing `settings.dictation.*` and `settings.shortcuts.*` in zh-CN.

**Step 3: Replace strings in SettingsView**

Use `t()` in Dictation and Shortcuts sections:

```tsx
<div className="settings-section-title">{t("settings.dictation.title")}</div>
<div className="settings-section-subtitle">{t("settings.dictation.subtitle")}</div>
...
<div className="settings-toggle-title">{t("settings.dictation.enable.title")}</div>
<div className="settings-toggle-subtitle">{t("settings.dictation.enable.subtitle")}</div>
...
<label ...>{t("settings.dictation.model")}</label>
<div className="settings-help">
  {t("settings.dictation.model_help", {
    note: selectedDictationModel.note,
    size: selectedDictationModel.size,
  })}
</div>
...
<label ...>{t("settings.dictation.preferred_language")}</label>
<option value="">{t("settings.dictation.language_options.auto")}</option>
...
<label ...>{t("settings.dictation.hold_key")}</label>
<option value="">{t("settings.dictation.hold_key_options.off")}</option>
...
<div className="settings-field-label">
  {t("settings.dictation.model_status", { model: selectedDictationModel.label })}
</div>
...
{dictationModelStatus.state === "ready" && t("settings.dictation.status.ready")}
...
```

Shortcuts section:

```tsx
<div className="settings-section-title">{t("settings.shortcuts.title")}</div>
<div className="settings-section-subtitle">{t("settings.shortcuts.subtitle")}</div>
<div className="settings-field-label">{t("settings.shortcuts.cycle_model")}</div>
<input placeholder={t("settings.shortcuts.input_placeholder")} ... />
<button ...>{t("settings.shortcuts.clear")}</button>
<div className="settings-help">
  {t("settings.shortcuts.shortcut_help", { shortcut: formatShortcut("cmd+shift+m") })}
</div>
```

**Step 4: Add Chinese translations**

Add to `zh-CN.json` (keys mirror English):

```json
{
  "settings": {
    "dictation": {
      "title": "语音输入",
      "subtitle": "启用本地转写的麦克风语音输入。",
      "enable": {
        "title": "启用语音输入",
        "subtitle": "首次使用时会下载选定的 Whisper 模型。"
      },
      "model": "语音模型",
      "model_help": "{{note}} 下载大小：{{size}}。",
      "preferred_language": "偏好的语音语言",
      "preferred_language_help": "自动检测仍开启；该选项会偏向你的语言。",
      "hold_key": "按住开始语音的按键",
      "hold_key_help": "按住开始语音，松开后停止并处理。",
      "model_status": "模型状态（{{model}}）",
      "status": {
        "ready": "可用。",
        "missing": "模型尚未下载。",
        "downloading": "正在下载模型...",
        "error": "下载失败。"
      },
      "actions": {
        "download": "下载模型",
        "cancel": "取消下载",
        "remove": "移除模型"
      },
      "language_options": {
        "auto": "仅自动检测",
        "en": "English",
        "es": "Español",
        "fr": "Français",
        "de": "Deutsch",
        "it": "Italiano",
        "pt": "Português",
        "nl": "Nederlands",
        "sv": "Svenska",
        "no": "Norsk",
        "da": "Dansk",
        "fi": "Suomi",
        "pl": "Polski",
        "tr": "Türkçe",
        "ru": "Русский",
        "uk": "Українська",
        "ja": "日本語",
        "ko": "한국어",
        "zh": "中文"
      },
      "hold_key_options": {
        "off": "关闭",
        "alt": "Option / Alt",
        "shift": "Shift",
        "control": "Control",
        "meta": "Command / Meta"
      }
    },
    "shortcuts": {
      "title": "快捷键",
      "subtitle": "自定义常用操作的快捷键。",
      "cycle_model": "切换模型",
      "cycle_access": "切换访问模式",
      "cycle_reasoning": "切换推理模式",
      "shortcut_help": "聚焦输入框后按下新快捷键。默认：{{shortcut}}",
      "shortcut_help_simple": "默认：{{shortcut}}",
      "input_placeholder": "输入快捷键",
      "clear": "清除"
    }
  }
}
```

**Step 5: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS.

**Step 6: Commit**

```bash
git add src/features/settings/components/SettingsView.tsx src/i18n/translations/en.json src/i18n/translations/zh-CN.json
git commit -m "feat: translate settings dictation/shortcuts"
```

---

### Task 5: Translate Settings - Codex + Experimental + Project overrides

**Files:**
- Modify: `src/features/settings/components/SettingsView.tsx`
- Modify: `src/i18n/translations/en.json`
- Modify: `src/i18n/translations/zh-CN.json`

**Step 1: Add English keys only (make test fail)**

Add to `en.json`:

```json
{
  "settings": {
    "codex": {
      "title": "Codex",
      "subtitle": "Configure your Codex binary and default access mode.",
      "path": "Codex path",
      "path_placeholder": "codex",
      "browse": "Browse",
      "save": "Save",
      "saving": "Saving...",
      "run_doctor": "Run doctor",
      "running": "Running...",
      "doctor_ok": "Codex looks good",
      "doctor_error": "Codex issue detected",
      "doctor_version": "Version: {{version}}",
      "doctor_app_server": "App-server: {{status}}",
      "doctor_node": "Node: {{status}}",
      "access_mode": "Default access mode",
      "access_mode_options": {
        "read-only": "Read only",
        "current": "On-request",
        "full-access": "Full access"
      },
      "backend_mode": "Backend mode",
      "backend_mode_options": {
        "local": "Local (default)",
        "remote": "Remote (daemon)"
      },
      "remote_backend": "Remote backend",
      "remote_host_aria": "Remote backend host",
      "remote_token_aria": "Remote backend token",
      "remote_token_placeholder": "Token (optional)",
      "workspace_overrides": "Workspace overrides",
      "override_placeholder": "Use default",
      "overrides_empty": "No projects yet."
    },
    "experimental": {
      "title": "Experimental",
      "subtitle": "Try early features before they are fully supported.",
      "collab": {
        "title": "Collab mode",
        "subtitle": "Allow agent collaboration in shared workspaces."
      },
      "unified_exec": {
        "title": "Background terminal",
        "subtitle": "Keep terminal sessions alive in the background."
      },
      "steer": {
        "title": "Steer mode",
        "subtitle": "Enable steer mode for richer guidance."
      }
    }
  }
}
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with missing `settings.codex.*` / `settings.experimental.*`.

**Step 3: Replace strings in SettingsView**

Use `t()` for Codex/Experimental sections and overrides:

```tsx
<div className="settings-section-title">{t("settings.codex.title")}</div>
<div className="settings-section-subtitle">{t("settings.codex.subtitle")}</div>
...
<label ...>{t("settings.codex.path")}</label>
<input placeholder={t("settings.codex.path_placeholder")} ... />
<button ...>{t("settings.codex.browse")}</button>
<button ...>{isSavingSettings ? t("settings.codex.saving") : t("settings.codex.save")}</button>
<button ...>{doctorState.status === "running" ? t("settings.codex.running") : t("settings.codex.run_doctor")}</button>
...
<div className="settings-doctor-title">
  {doctorState.result.ok ? t("settings.codex.doctor_ok") : t("settings.codex.doctor_error")}
</div>
<div>{t("settings.codex.doctor_version", { version: doctorState.result.version ?? "unknown" })}</div>
...
<label ...>{t("settings.codex.access_mode")}</label>
<option value="read-only">{t("settings.codex.access_mode_options.read-only")}</option>
...
<label ...>{t("settings.codex.backend_mode")}</label>
<option value="local">{t("settings.codex.backend_mode_options.local")}</option>
...
<div className="settings-field-label">{t("settings.codex.remote_backend")}</div>
<input aria-label={t("settings.codex.remote_host_aria")} ... />
<input placeholder={t("settings.codex.remote_token_placeholder")} ... />
...
<div className="settings-field-label">{t("settings.codex.workspace_overrides")}</div>
<input placeholder={t("settings.codex.override_placeholder")} ... />
{projects.length === 0 && <div className="settings-empty">{t("settings.codex.overrides_empty")}</div>}
```

Experimental toggles:

```tsx
<div className="settings-section-title">{t("settings.experimental.title")}</div>
<div className="settings-section-subtitle">{t("settings.experimental.subtitle")}</div>
...
<div className="settings-toggle-title">{t("settings.experimental.collab.title")}</div>
<div className="settings-toggle-subtitle">{t("settings.experimental.collab.subtitle")}</div>
```

**Step 4: Add Chinese translations**

Add to `zh-CN.json` (mirror the English keys):

```json
{
  "settings": {
    "codex": {
      "title": "Codex",
      "subtitle": "配置 Codex 可执行文件与默认访问模式。",
      "path": "Codex 路径",
      "path_placeholder": "codex",
      "browse": "浏览",
      "save": "保存",
      "saving": "保存中...",
      "run_doctor": "运行诊断",
      "running": "运行中...",
      "doctor_ok": "Codex 状态正常",
      "doctor_error": "检测到 Codex 问题",
      "doctor_version": "版本：{{version}}",
      "doctor_app_server": "App-server：{{status}}",
      "doctor_node": "Node：{{status}}",
      "access_mode": "默认访问模式",
      "access_mode_options": {
        "read-only": "只读",
        "current": "按需授权",
        "full-access": "完全访问"
      },
      "backend_mode": "后端模式",
      "backend_mode_options": {
        "local": "本地（默认）",
        "remote": "远程（守护进程）"
      },
      "remote_backend": "远程后端",
      "remote_host_aria": "远程后端地址",
      "remote_token_aria": "远程后端令牌",
      "remote_token_placeholder": "令牌（可选）",
      "workspace_overrides": "工作区覆盖设置",
      "override_placeholder": "使用默认值",
      "overrides_empty": "暂无项目。"
    },
    "experimental": {
      "title": "实验性功能",
      "subtitle": "尝试尚未完全支持的特性。",
      "collab": {
        "title": "协作模式",
        "subtitle": "允许在共享工作区中进行协作。"
      },
      "unified_exec": {
        "title": "后台终端",
        "subtitle": "让终端会话在后台保持运行。"
      },
      "steer": {
        "title": "引导模式",
        "subtitle": "启用更丰富的引导能力。"
      }
    }
  }
}
```

**Step 5: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS.

**Step 6: Commit**

```bash
git add src/features/settings/components/SettingsView.tsx src/i18n/translations/en.json src/i18n/translations/zh-CN.json
git commit -m "feat: translate settings codex/experimental"
```

---

### Task 6: Translate App shell (tabs, git status, worktree banners)

**Files:**
- Modify: `src/App.tsx`
- Modify: `src/features/app/components/Sidebar.tsx`
- Modify: `src/features/app/components/MainHeader.tsx`
- Modify: `src/i18n/translations/en.json`
- Modify: `src/i18n/translations/zh-CN.json`

**Step 1: Add English keys only (make test fail)**

Add to `en.json`:

```json
{
  "app": {
    "tabs": {
      "projects": "Projects",
      "codex": "Codex",
      "git": "Git",
      "files": "Files",
      "prompts": "Prompts"
    },
    "git_status": {
      "unavailable": "Git status unavailable",
      "clean": "Working tree clean",
      "changes_single": "{{count}} change",
      "changes_plural": "{{count}} changes"
    },
    "worktree": {
      "apply": "Apply",
      "apply_help": "Apply changes to parent workspace"
    },
    "actions": {
      "go_projects": "Go to projects"
    }
  }
}
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with missing `app.*` keys in zh-CN.

**Step 3: Replace strings in App shell**

In `src/App.tsx`:

```tsx
const { t } = useI18n();
...
const gitStatusText = !gitStatus
  ? t("app.git_status.unavailable")
  : gitStatus.files.length > 0
    ? t(
        gitStatus.files.length === 1
          ? "app.git_status.changes_single"
          : "app.git_status.changes_plural",
        { count: gitStatus.files.length },
      )
    : t("app.git_status.clean");
...
worktreeApplyLabel: t("app.worktree.apply"),
worktreeApplyHelp: t("app.worktree.apply_help"),
...
onGoProjects: () => setActiveTab("projects"),
```

Update `Sidebar.tsx` / `MainHeader.tsx` nav labels to use `t("app.tabs.*")`.

**Step 4: Add Chinese translations**

Add to `zh-CN.json`:

```json
{
  "app": {
    "tabs": {
      "projects": "项目",
      "codex": "Codex",
      "git": "Git",
      "files": "文件",
      "prompts": "提示词"
    },
    "git_status": {
      "unavailable": "无法获取 Git 状态",
      "clean": "工作区干净",
      "changes_single": "{{count}} 个改动",
      "changes_plural": "{{count}} 个改动"
    },
    "worktree": {
      "apply": "应用",
      "apply_help": "将改动应用到父工作区"
    },
    "actions": {
      "go_projects": "返回项目"
    }
  }
}
```

**Step 5: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS.

**Step 6: Commit**

```bash
git add src/App.tsx src/features/app/components/Sidebar.tsx src/features/app/components/MainHeader.tsx src/i18n/translations/en.json src/i18n/translations/zh-CN.json
git commit -m "feat: translate app shell"
```

---

### Task 7: Translate Home + Update + About + Debug

**Files:**
- Modify: `src/features/home/components/Home.tsx`
- Modify: `src/features/update/components/UpdateToast.tsx`
- Modify: `src/features/about/components/AboutView.tsx`
- Modify: `src/features/debug/components/DebugPanel.tsx`
- Modify: `src/i18n/translations/en.json`
- Modify: `src/i18n/translations/zh-CN.json`

**Step 1: Add English keys only (make test fail)**

Add to `en.json`:

```json
{
  "home": {
    "title": "Home",
    "empty": "No recent runs yet.",
    "latest_runs": "Latest runs"
  },
  "update": {
    "available": "Update available",
    "install": "Install update",
    "downloading": "Downloading update...",
    "restart": "Restart to update"
  },
  "about": {
    "version": "Version {{version}}",
    "version_unknown": "Version —",
    "tagline": "Monitor and orchestrate Codex agents across workspaces.",
    "made_by": "Made with ♥ by Codex & Dimillian",
    "open_github": "GitHub",
    "open_twitter": "Twitter"
  },
  "debug": {
    "title": "Debug",
    "copy": "Copy",
    "clear": "Clear",
    "empty": "No debug events yet.",
    "resize_label": "Resize debug panel"
  }
}
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with missing `home.*` / `update.*` / `about.*` / `debug.*`.

**Step 3: Replace strings in components**

Use `t()` in each component, e.g.:

```tsx
<div className="debug-title">{t("debug.title")}</div>
<button ...>{t("debug.copy")}</button>
<div className="debug-empty">{t("debug.empty")}</div>
```

**Step 4: Add Chinese translations**

Add to `zh-CN.json`:

```json
{
  "home": {
    "title": "首页",
    "empty": "暂无最近运行记录。",
    "latest_runs": "最近运行"
  },
  "update": {
    "available": "发现更新",
    "install": "安装更新",
    "downloading": "正在下载更新...",
    "restart": "重启以更新"
  },
  "about": {
    "version": "版本 {{version}}",
    "version_unknown": "版本 —",
    "tagline": "在多个工作区监控和编排 Codex 代理。",
    "made_by": "由 Codex & Dimillian 用 ♥ 制作",
    "open_github": "GitHub",
    "open_twitter": "Twitter"
  },
  "debug": {
    "title": "调试",
    "copy": "复制",
    "clear": "清空",
    "empty": "暂无调试事件。",
    "resize_label": "调整调试面板大小"
  }
}
```

**Step 5: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS.

**Step 6: Commit**

```bash
git add src/features/home/components/Home.tsx src/features/update/components/UpdateToast.tsx src/features/about/components/AboutView.tsx src/features/debug/components/DebugPanel.tsx src/i18n/translations/en.json src/i18n/translations/zh-CN.json
git commit -m "feat: translate home/update/about/debug"
```

---

### Task 8: Translate Git UI + issues

**Files:**
- Modify: `src/features/git/components/GitDiffPanel.tsx`
- Modify: `src/features/git/components/GitDiffViewer.tsx`
- Modify: `src/features/git/components/GitHubIssuesPanel.tsx` (if present)
- Modify: `src/features/git/components/DiffBlock.tsx`
- Modify: `src/i18n/translations/en.json`
- Modify: `src/i18n/translations/zh-CN.json`

**Step 1: Add English keys only (make test fail)**

Add to `en.json`:

```json
{
  "git": {
    "diff_unavailable": "Diff unavailable.",
    "no_changes": "No changes detected.",
    "pr": {
      "summary": "Pull request summary",
      "jump_first": "Jump to first file",
      "activity": "Activity",
      "draft": "Draft",
      "empty_body": "No description provided."
    },
    "issues": {
      "title": "Issues",
      "empty": "No issues found."
    }
  }
}
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with missing `git.*` in zh-CN.

**Step 3: Replace strings in Git UI components**

Use `t()` for headers, empty states, aria-labels, and status labels:

```tsx
<div className="diff-viewer-placeholder">{t("git.diff_unavailable")}</div>
<div className="diff-viewer-empty">{t("git.no_changes")}</div>
<section aria-label={t("git.pr.summary")}>...</section>
```

**Step 4: Add Chinese translations**

Add to `zh-CN.json`:

```json
{
  "git": {
    "diff_unavailable": "无法显示差异。",
    "no_changes": "未检测到改动。",
    "pr": {
      "summary": "拉取请求概览",
      "jump_first": "跳到第一个文件",
      "activity": "动态",
      "draft": "草稿",
      "empty_body": "没有提供描述。"
    },
    "issues": {
      "title": "问题",
      "empty": "暂无问题。"
    }
  }
}
```

**Step 5: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS.

**Step 6: Commit**

```bash
git add src/features/git/components src/i18n/translations/en.json src/i18n/translations/zh-CN.json
git commit -m "feat: translate git ui"
```

---

### Task 9: Translate remaining UI (composer, threads, workspaces, files, prompts)

**Files:**
- Modify: `src/features/composer/**`
- Modify: `src/features/threads/**`
- Modify: `src/features/workspaces/**`
- Modify: `src/features/files/**`
- Modify: `src/features/prompts/**` (if present)
- Modify: `src/features/messages/**`
- Modify: `src/i18n/translations/en.json`
- Modify: `src/i18n/translations/zh-CN.json`

**Step 1: Add English keys only (make test fail)**

Add new keys for each component’s UI strings. Example structure:

```json
{
  "composer": { "send": "Send", "placeholder": "Type a message..." },
  "threads": { "empty": "No threads yet." },
  "workspaces": { "add": "Add workspace" },
  "files": { "empty": "No files." },
  "prompts": { "title": "Prompts" },
  "messages": { "copy": "Copy", "retry": "Retry" }
}
```

**Step 2: Run test to verify it fails**

Run: `npm run test:i18n`  
Expected: FAIL with missing keys in zh-CN.

**Step 3: Replace strings in each component**

Import `useI18n` and replace literals with `t(...)`. Use consistent key names per feature.

**Step 4: Add Chinese translations**

Add mirror keys in `zh-CN.json`:

```json
{
  "composer": { "send": "发送", "placeholder": "输入消息..." },
  "threads": { "empty": "暂无对话。" },
  "workspaces": { "add": "添加工作区" },
  "files": { "empty": "暂无文件。" },
  "prompts": { "title": "提示词" },
  "messages": { "copy": "复制", "retry": "重试" }
}
```

**Step 5: Run test to verify it passes**

Run: `npm run test:i18n`  
Expected: PASS.

**Step 6: Commit**

```bash
git add src/features src/i18n/translations/en.json src/i18n/translations/zh-CN.json
git commit -m "feat: translate remaining ui"
```

---

### Task 10: Final verification

**Step 1: Run lint**

Run: `npm run lint`  
Expected: PASS.

**Step 2: Run typecheck**

Run: `npm run typecheck`  
Expected: PASS.

**Step 3: Commit (if any changes)**

```bash
git status -sb
```

If needed:

```bash
git add .
git commit -m "chore: finalize ui i18n"
```
